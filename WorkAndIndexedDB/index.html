<!DOCTYPE html>

<html>
<head>
    <script>

        // fun with workers and  indexedDB
        // threads in the browser! 

        var worker = new Worker('watchers.js');

        worker.onmessage = function (event) {
            renderTodo(event.data);
        };

        function renderTodo(row) {
            var todos = document.getElementById("todoItems");
            var li = document.createElement("li");
            var a = document.createElement("a");
            var dt = new Date(row.timeStamp);
            var t = document.createTextNode(row.text + " " + dt);

            a.addEventListener("click", function () {
                // TODO: need to change the api
                johndemo.indexedDB.deleteTodo(row.id);
            }, false);

            a.href = "#";
            a.textContent = " [Delete]";
            li.appendChild(t);
            li.appendChild(a);
            todos.appendChild(li);
        }

        function addTodo() {
            var todo = document.getElementById("todo").value;
            document.getElementById("error").style["visibility"] = "hidden";
            if (!todo) {
                document.getElementById("error").style["visibility"] = "visible";
                return;
            }
            document.getElementById("todo").value = "";
            var todos = document.getElementById("todoItems");
            todos.innerHTML = null;
            worker.postMessage(todo);
        }
    </script>
    <meta name="viewport" content="width=device-width" />
    <title>indexedDb</title>
</head>
<body>
    <div>
        <p id="result"></p>
    </div>
    <div>
        <p id="error" style="visibility: hidden;color: red;">text required.</p>
        <ul id="todoItems"></ul>
        <input type="text" id="todo" name="todo" placeholder="What do you need to do?" style="width: 200px;">
        <input type="submit" value="Add Todo Item" onclick="addTodo(); return false;">
    </div>
</body>
</html>
